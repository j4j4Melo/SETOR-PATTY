<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setor Patty - Relatório de Metas | Fevereiro 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* [MANTENHA TODO O CSS EXISTENTE AQUI] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #f72585;
            --success: #06d6a0;
            --danger: #ef476f;
            --warning: #ffd166;
            --info: #4cc9f0;
            --light: #f8f9fa;
            --dark: #2b2d42;
            --gray: #8d99ae;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.15);
            --shadow-sm: 0 5px 15px rgba(0,0,0,0.08);
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            background: #f1f5f9;
            min-height: 100vh;
            padding: 30px 20px;
        }

        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: var(--gradient-1);
            padding: 30px;
            border-radius: 24px;
            margin-bottom: 30px;
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header-title p {
            font-size: 16px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title p i {
            font-size: 18px;
        }

        .header-date {
            background: rgba(255,255,255,0.2);
            padding: 15px 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .header-date .day {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
        }

        .header-date .month {
            font-size: 16px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .date-selector {
            background: rgba(255,255,255,0.15);
            padding: 8px 15px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: 20px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .date-selector button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .date-selector button:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .date-selector span {
            font-weight: 600;
            min-width: 140px;
            text-align: center;
        }

        /* NOVOS ESTILOS PARA FILTROS DE PERÍODO */
        .period-filters {
            background: white;
            padding: 20px 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .period-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--light);
            padding: 5px;
            border-radius: 50px;
            border: 1px solid #e9ecef;
        }

        .period-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: var(--gray);
        }

        .period-btn:hover {
            color: var(--primary);
        }

        .period-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.2);
        }

        .date-range {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }

        .date-range-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 30px;
            border: 1px solid #e9ecef;
        }

        .date-range-item label {
            font-size: 13px;
            font-weight: 600;
            color: var(--dark);
        }

        .date-range-item input {
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            color: var(--primary);
            width: 110px;
            padding: 5px;
            border-radius: 8px;
        }

        .date-range-item input:focus {
            outline: 2px solid var(--primary);
            background: white;
        }

        .filters {
            background: white;
            padding: 20px 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 250px;
        }

        .filter-group label {
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
            min-width: 70px;
        }

        .multi-select {
            position: relative;
            flex: 1;
        }

        .multi-select .select-btn {
            width: 100%;
            padding: 12px 18px;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            background: white;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .multi-select .select-btn:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .multi-select .select-btn .selected-count {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .multi-select .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            margin-top: 8px;
            max-height: 350px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow);
            display: none;
        }

        .multi-select .dropdown-menu.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .multi-select .search-box {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .multi-select .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 13px;
            transition: all 0.3s;
        }

        .multi-select .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .multi-select .select-all {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            transition: background 0.2s;
        }

        .multi-select .select-all:hover {
            background: #f8f9fa;
        }

        .multi-select .select-all i {
            font-size: 16px;
        }

        .multi-select .options-list {
            padding: 8px 0;
        }

        .multi-select .option-item {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .multi-select .option-item:hover {
            background: #f8f9fa;
            border-left-color: var(--primary);
        }

        .multi-select .option-item.selected {
            background: rgba(67, 97, 238, 0.05);
            border-left-color: var(--primary);
        }

        .multi-select .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        select {
            padding: 12px 18px;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 4px 10px rgba(6, 214, 160, 0.3);
        }

        .btn-success:hover {
            background: #05b586;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(6, 214, 160, 0.4);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .kpi-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, transparent 50%, rgba(67, 97, 238, 0.03) 100%);
            border-radius: 50%;
        }

        .kpi-icon {
            width: 55px;
            height: 55px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            margin-bottom: 18px;
            position: relative;
            z-index: 1;
        }

        .kpi-icon.blue { background: linear-gradient(135deg, #4361ee20, #4361ee40); color: var(--primary); }
        .kpi-icon.green { background: linear-gradient(135deg, #06d6a020, #06d6a040); color: var(--success); }
        .kpi-icon.orange { background: linear-gradient(135deg, #f7258520, #f7258540); color: var(--secondary); }
        .kpi-icon.red { background: linear-gradient(135deg, #ef476f20, #ef476f40); color: var(--danger); }
        .kpi-icon.purple { background: linear-gradient(135deg, #9b5de520, #9b5de540); color: #9b5de5; }

        .kpi-label {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .kpi-trend {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding-top: 8px;
            border-top: 1px solid #e9ecef;
        }

        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .chart-card:hover {
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .chart-header h3 {
            color: var(--dark);
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-header h3 i {
            color: var(--primary);
            font-size: 20px;
        }

        .chart-header .badge {
            background: var(--light);
            padding: 6px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray);
        }

        .chart-wrapper {
            position: relative;
            height: 320px;
            margin-top: 10px;
        }

        .tables-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .table-card {
            background: white;
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .table-header h2 {
            color: var(--dark);
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-header h2 i {
            color: var(--primary);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid #f1f5f9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: #f8fafc;
            color: var(--dark);
            padding: 16px 12px;
            font-weight: 700;
            text-align: center;
            white-space: nowrap;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 2px solid #e9ecef;
        }

        th:hover {
            background: #f1f5f9;
        }

        th i {
            margin-left: 5px;
            font-size: 12px;
            color: var(--gray);
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid #f1f5f9;
            text-align: center;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: #f8fafc;
        }

        .meta-sim {
            background: linear-gradient(135deg, #06d6a020, #06d6a040);
            color: var(--success);
            font-weight: 700;
            border-radius: 30px;
            padding: 6px 16px;
            display: inline-block;
            font-size: 12px;
        }

        .meta-nao {
            background: linear-gradient(135deg, #ef476f20, #ef476f40);
            color: var(--danger);
            font-weight: 700;
            border-radius: 30px;
            padding: 6px 16px;
            display: inline-block;
            font-size: 12px;
        }

        .valor-positivo {
            color: var(--success);
            font-weight: 700;
        }

        .valor-negativo {
            color: var(--danger);
            font-weight: 700;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f1f5f9;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-1);
            border-radius: 10px;
            transition: width 0.3s;
        }

        .info-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .info-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #f1f5f9;
            transition: all 0.3s;
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }

        .info-icon {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .info-content h4 {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .info-content p {
            color: var(--dark);
            font-size: 20px;
            font-weight: 700;
        }

        .footer {
            margin-top: 50px;
            text-align: center;
            color: var(--gray);
            font-size: 13px;
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .tables-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .header-content { flex-direction: column; text-align: center; }
            .kpi-grid { grid-template-columns: 1fr; }
            .info-cards { grid-template-columns: 1fr; }
            .filters { flex-direction: column; }
            .filter-group { width: 100%; }
            .multi-select { width: 100%; }
            .period-filters { flex-direction: column; }
            .period-group { width: 100%; justify-content: center; }
            .date-range { margin-left: 0; width: 100%; justify-content: center; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .kpi-card, .chart-card, .table-card {
            animation: slideIn 0.5s ease-out;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark);
        }

        .dropdown-close {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border-top: 1px solid #e9ecef;
            cursor: pointer;
            color: var(--gray);
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .dropdown-close:hover {
            background: #f8f9fa;
            color: var(--danger);
        }

        .dropdown-close i {
            font-size: 14px;
        }

        .store-name {
            font-weight: 600;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1><i class="fas fa-store-alt" style="margin-right: 12px;"></i>Setor Patty</h1>
                    <p>
                        <i class="fas fa-store"></i> 31 Lojas em operação 
                        <i class="fas fa-circle" style="font-size: 6px; margin: 0 8px;"></i>
                        <i class="fas fa-chart-line"></i> Atualizado em tempo real
                    </p>
                </div>
                <div style="display: flex; align-items: center;">
                    <div class="header-date">
                        <div class="day" id="headerDay">10-14</div>
                        <div class="month" id="headerMonth">PERÍODO SELECIONADO</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NOVOS FILTROS DE PERÍODO -->
        <div class="period-filters">
            <div class="period-group">
                <button class="period-btn active" onclick="setPeriodo('hoje')">Hoje</button>
                <button class="period-btn" onclick="setPeriodo('7d')">Últimos 7 dias</button>
                <button class="period-btn" onclick="setPeriodo('15d')">Últimos 15 dias</button>
                <button class="period-btn" onclick="setPeriodo('mes')">Mês fechado</button>
                <button class="period-btn" onclick="setPeriodo('custom')">Personalizado</button>
            </div>
            <div class="date-range" id="dateRangeInputs" style="display: none;">
                <div class="date-range-item">
                    <label>De:</label>
                    <input type="date" id="dataInicio" onchange="atualizarPorData()">
                </div>
                <div class="date-range-item">
                    <label>Até:</label>
                    <input type="date" id="dataFim" onchange="atualizarPorData()">
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label><i class="fas fa-store"></i> Lojas:</label>
                <div class="multi-select" id="lojaMultiSelect">
                    <div class="select-btn" onclick="toggleLojaDropdown()">
                        <span id="selectedLojasText">Todas as Lojas</span>
                        <span class="selected-count" id="selectedCount">31</span>
                    </div>
                    <div class="dropdown-menu" id="lojaDropdown">
                        <div class="search-box">
                            <input type="text" id="lojaSearch" placeholder="Buscar loja..." onkeyup="filtrarLojas()">
                        </div>
                        <div class="select-all" onclick="toggleAllLojas()">
                            <i class="fas fa-check-square"></i> Selecionar Todas
                        </div>
                        <div class="options-list" id="lojaOptions"></div>
                        <div class="dropdown-close" onclick="fecharDropdownLojas()">
                            <i class="fas fa-times"></i> Fechar
                        </div>
                    </div>
                </div>
            </div>
            <div class="filter-group">
                <label><i class="fas fa-chart-bar"></i> Status:</label>
                <select id="statusFilter" onchange="aplicarFiltros()">
                    <option value="">Todos os Status</option>
                    <option value="SIM">Meta Atingida</option>
                    <option value="NÃO">Meta Não Atingida</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="aplicarFiltros()">
                <i class="fas fa-sync-alt"></i> Atualizar Dados
            </button>
            <button class="btn btn-success" onclick="exportarExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-icon blue"><i class="fas fa-store"></i></div>
                <div class="kpi-label">Total de Lojas</div>
                <div class="kpi-value" id="totalLojas">31</div>
                <div class="kpi-trend"><i class="fas fa-check-circle trend-up"></i> 100% operantes</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon green"><i class="fas fa-dollar-sign"></i></div>
                <div class="kpi-label">Faturamento Total</div>
                <div class="kpi-value" id="totalFaturamento">R$ 0,00</div>
                <div class="kpi-trend"><i class="fas fa-chart-line"></i> <span id="percentualMeta">0,00%</span> vs meta</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon purple"><i class="fas fa-bullseye"></i></div>
                <div class="kpi-label">Meta Total</div>
                <div class="kpi-value" id="totalMeta">R$ 0,00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressoMeta" style="width: 0%"></div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon red"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="kpi-label">Diferença</div>
                <div class="kpi-value" id="totalDiferenca">R$ 0,00</div>
                <div class="kpi-trend"><i class="fas fa-arrow-down trend-down"></i> <span id="percentualDiferenca">0,00%</span> abaixo</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon blue"><i class="fas fa-ticket-alt"></i></div>
                <div class="kpi-label">Ticket Médio</div>
                <div class="kpi-value" id="ticketMedio">R$ 0,00</div>
                <div class="kpi-trend"><i class="fas fa-chart-line trend-up"></i> período selecionado</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon orange"><i class="fas fa-trophy"></i></div>
                <div class="kpi-label">Metas Atingidas</div>
                <div class="kpi-value" id="metasAtingidas">0/31</div>
                <div class="kpi-trend"><i class="fas fa-percent"></i> <span id="percentualLojas">0,0%</span> das lojas</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-pie" style="color: var(--primary);"></i>Distribuição por Canal</h3>
                    <span class="badge"><i class="fas fa-store-alt"></i> Vendas</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="canalPieChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-bullseye" style="color: var(--secondary);"></i>Atingimento de Metas</h3>
                    <span class="badge"><i class="fas fa-check-circle"></i> Performance</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="metasPieChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-bar" style="color: var(--success);"></i>Top 10 Lojas - Faturamento vs Meta</h3>
                    <span class="badge"><i class="fas fa-crown"></i> Ranking</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="top10BarChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-line" style="color: var(--warning);"></i>Desempenho por Loja</h3>
                    <span class="badge"><i class="fas fa-percent"></i> Atingimento</span>
                </div>
                <div class="chart-wrapper">
                    <canvas id="desempenhoBarChart"></canvas>
                </div>
            </div>
        </div>

        <div class="tables-section">
            <div class="table-card">
                <div class="table-header">
                    <h2><i class="fas fa-list"></i> Detalhamento por Loja</h2>
                    <span class="badge"><i class="fas fa-table"></i> Dados detalhados</span>
                </div>
                <div class="table-wrapper">
                    <table id="mainTable">
                        <thead>
                            <tr>
                                <th onclick="ordenarTabela(0)">Data <i class="fas fa-sort"></i></th>
                                <th onclick="ordenarTabela(1)">Loja <i class="fas fa-sort"></i></th>
                                <th>Início</th>
                                <th>Fim</th>
                                <th onclick="ordenarTabela(4)">Cupons <i class="fas fa-sort"></i></th>
                                <th onclick="ordenarTabela(5)">Faturamento <i class="fas fa-sort"></i></th>
                                <th onclick="ordenarTabela(6)">Meta <i class="fas fa-sort"></i></th>
                                <th>Diferença</th>
                                <th onclick="ordenarTabela(8)">Dif % <i class="fas fa-sort"></i></th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h2><i class="fas fa-chart-pie"></i> Resumo por Canal</h2>
                    <span class="badge"><i class="fas fa-chart-simple"></i> Análise</span>
                </div>
                <div class="table-wrapper">
                    <table id="canaisTable">
                        <thead>
                            <tr>
                                <th>Canal</th>
                                <th>Valor (R$)</th>
                                <th>Participação</th>
                                <th>Performance</th>
                            </tr>
                        </thead>
                        <tbody id="canaisTableBody"></tbody>
                    </table>
                </div>

                <div style="margin-top: 25px;">
                    <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 16px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-simple" style="color: var(--primary);"></i> Indicadores Gerais
                    </h3>
                    <div class="info-cards">
                        <div class="info-card">
                            <div class="info-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="info-content">
                                <h4>Lojas que Atingiram Meta</h4>
                                <p id="lojasMetaSim">0 lojas (0.0%)</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <div class="info-icon"><i class="fas fa-times-circle"></i></div>
                            <div class="info-content">
                                <h4>Lojas Abaixo da Meta</h4>
                                <p id="lojasMetaNao">0 lojas (0.0%)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><i class="far fa-clock"></i> Período: <span id="periodoDisplay">10 a 14 de Fevereiro de 2026</span></p>
            <p style="margin-top: 5px;">© 2026 Setor Patty - Todos os direitos reservados</p>
        </div>
    </div>

    <script>
        // MAPEAMENTO COMPLETO DOS NOMES DAS LOJAS (extraído da planilha)
        const lojaNomes = {
            5: "ANTONIO AGU",
            10: "OSASCO PLAZA",
            28: "SHOPPING TAMBORÉ",
            31: "AUGUSTA",
            63: "SHOPPING ITAPECERICA",
            69: "PERUS",
            73: "BRIGADEIRO JARDINS",
            82: "TEODORO SAMPAIO",
            86: "REX RAFAEL DE BARROS",
            90: "SHOPPING PARQUE BARUERI",
            97: "ASSAÍ JOÃO DIAS",
            98: "FRANCO DA ROCHA",
            101: "CARREFOUR RAPOSO TAVARES",
            118: "SHOPPING ITAPECERICA II",
            126: "OSASCO JOÃO DE ANDRADE",
            133: "PARQUE TIETÊ",
            145: "ITASHOPPING",
            157: "JARDIM SÃO LUIZ",
            158: "ASSAÍ CARAPICUÍBA",
            162: "MARQUESA TAIPAS",
            178: "EXTRA CARAPICUÍBA",
            183: "FRANCO DA ROCHA 2",
            189: "SHOPPING PATIO CIANÊ",
            195: "EXTRA JARAGUÁ",
            210: "ASSAÍ ABOLIÇÃO CAMPINAS",
            247: "METRÔ CCR VILA DAS BELEZAS",
            248: "METRÔ CCR CAPÃO REDONDO",
            251: "SOROCABA CENTRO",
            262: "ASSAÍ INDAIATUBA",
            285: "EXTRA JARDIM ÂNGELA",
            294: "SHOPPING RAPOSO"
        };

        // DADOS COMPLETOS POR DATA (10 a 14 de fevereiro)
        const dadosPorData = {
            "10/02/2026": [
                {loja: 5, inicio: '09:15', fim: '20:38', cupons: 98, faturamento: 3125.45, meta: 3980.0, canais: {auto: 845.30, delivery: 1980.25, viagem: 299.90}},
                {loja: 10, inicio: '13:48', fim: '21:28', cupons: 385, faturamento: 9876.54, meta: 10580.0, canais: {auto: 2345.67, delivery: 3120.45, viagem: 1543.21}},
                {loja: 28, inicio: '10:12', fim: '21:50', cupons: 165, faturamento: 4123.67, meta: 5190.0, canais: {auto: 1345.23, delivery: 2345.67, viagem: 432.77}},
                {loja: 31, inicio: '09:30', fim: '21:15', cupons: 152, faturamento: 2987.43, meta: 4255.0, canais: {auto: 0, delivery: 987.65, viagem: 0}},
                {loja: 63, inicio: '10:30', fim: '21:30', cupons: 68, faturamento: 987.65, meta: 2030.0, canais: {auto: 198.76, delivery: 0, viagem: 788.89}},
                {loja: 69, inicio: '09:00', fim: '21:38', cupons: 189, faturamento: 4789.23, meta: 4545.0, canais: {auto: 0, delivery: 3456.78, viagem: 1332.45}},
                {loja: 73, inicio: '10:35', fim: '18:25', cupons: 78, faturamento: 1987.54, meta: 2790.0, canais: {auto: 654.32, delivery: 876.54, viagem: 456.68}},
                {loja: 82, inicio: '09:01', fim: '19:48', cupons: 156, faturamento: 2876.43, meta: 2970.0, canais: {auto: 345.67, delivery: 1876.54, viagem: 0}},
                {loja: 86, inicio: '10:03', fim: '21:27', cupons: 95, faturamento: 3321.87, meta: 6380.0, canais: {auto: 1234.56, delivery: 567.89, viagem: 134.56}},
                {loja: 90, inicio: '10:22', fim: '22:00', cupons: 176, faturamento: 4234.56, meta: 4320.0, canais: {auto: 1567.89, delivery: 198.76, viagem: 654.32}},
                {loja: 97, inicio: '10:21', fim: '04:15', cupons: 142, faturamento: 3987.65, meta: 4075.0, canais: {auto: 1987.65, delivery: 123.45, viagem: 487.65}},
                {loja: 98, inicio: '08:38', fim: '19:22', cupons: 234, faturamento: 3123.45, meta: 4220.0, canais: {auto: 456.78, delivery: 498.76, viagem: 2167.91}},
                {loja: 101, inicio: '10:36', fim: '20:50', cupons: 105, faturamento: 2345.67, meta: 2425.0, canais: {auto: 0, delivery: 1345.67, viagem: 1000.00}},
                {loja: 118, inicio: '10:18', fim: '21:55', cupons: 92, faturamento: 1987.54, meta: 2895.0, canais: {auto: 876.54, delivery: 456.78, viagem: 654.22}},
                {loja: 126, inicio: '10:12', fim: '21:27', cupons: 356, faturamento: 9876.54, meta: 11530.0, canais: {auto: 567.89, delivery: 5678.90, viagem: 28.76}},
                {loja: 133, inicio: '10:05', fim: '21:44', cupons: 148, faturamento: 4876.54, meta: 5850.0, canais: {auto: 234.56, delivery: 3567.89, viagem: 876.54}},
                {loja: 145, inicio: '09:02', fim: '09:16', cupons: 128, faturamento: 2123.45, meta: 4245.0, canais: {auto: 654.32, delivery: 654.32, viagem: 876.54}},
                {loja: 157, inicio: '10:19', fim: '21:17', cupons: 95, faturamento: 2234.56, meta: 3380.0, canais: {auto: 0, delivery: 1456.78, viagem: 777.78}},
                {loja: 158, inicio: '09:47', fim: '21:37', cupons: 152, faturamento: 4123.45, meta: 4400.0, canais: {auto: 2234.56, delivery: 1567.89, viagem: 321.00}},
                {loja: 162, inicio: '09:20', fim: '20:39', cupons: 82, faturamento: 2654.32, meta: 3065.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 178, inicio: '09:25', fim: '22:08', cupons: 112, faturamento: 3654.32, meta: 2245.0, canais: {auto: 0, delivery: 2654.32, viagem: 0}},
                {loja: 183, inicio: '09:33', fim: '19:23', cupons: 114, faturamento: 1876.54, meta: 2995.0, canais: {auto: 876.54, delivery: 456.78, viagem: 543.22}},
                {loja: 189, inicio: '09:50', fim: '21:51', cupons: 187, faturamento: 2234.56, meta: 2805.0, canais: {auto: 654.32, delivery: 345.67, viagem: 1234.57}},
                {loja: 195, inicio: '10:13', fim: '21:22', cupons: 231, faturamento: 5876.54, meta: 6565.0, canais: {auto: 0, delivery: 3876.54, viagem: 2000.00}},
                {loja: 210, inicio: '08:42', fim: '20:46', cupons: 115, faturamento: 2654.32, meta: 3790.0, canais: {auto: 0, delivery: 987.65, viagem: 0}},
                {loja: 247, inicio: '08:43', fim: '20:28', cupons: 101, faturamento: 1567.89, meta: 2025.0, canais: {auto: 0, delivery: 567.89, viagem: 1000.00}},
                {loja: 248, inicio: '07:31', fim: '23:48', cupons: 254, faturamento: 5432.10, meta: 5710.0, canais: {auto: 345.67, delivery: 2765.43, viagem: 1765.43}},
                {loja: 251, inicio: '08:34', fim: '15:55', cupons: 79, faturamento: 987.65, meta: 1910.0, canais: {auto: 0, delivery: 54.32, viagem: 933.33}},
                {loja: 262, inicio: '08:28', fim: '21:14', cupons: 87, faturamento: 2234.56, meta: 2330.0, canais: {auto: 0, delivery: 1123.45, viagem: 987.65}},
                {loja: 285, inicio: '10:43', fim: '21:41', cupons: 82, faturamento: 1567.89, meta: 3350.0, canais: {auto: 0, delivery: 498.76, viagem: 1069.13}},
                {loja: 294, inicio: '10:31', fim: '21:28', cupons: 108, faturamento: 1987.65, meta: 1965.0, canais: {auto: 321.45, delivery: 654.32, viagem: 987.65}}
            ],
            "11/02/2026": [
                {loja: 5, inicio: '09:12', fim: '20:40', cupons: 105, faturamento: 3345.67, meta: 3995.0, canais: {auto: 876.54, delivery: 1987.65, viagem: 298.76}},
                {loja: 10, inicio: '13:50', fim: '21:30', cupons: 412, faturamento: 10567.89, meta: 10600.0, canais: {auto: 2456.78, delivery: 3345.67, viagem: 1678.90}},
                {loja: 28, inicio: '10:14', fim: '21:52', cupons: 178, faturamento: 4321.98, meta: 5205.0, canais: {auto: 1432.10, delivery: 2543.21, viagem: 398.76}},
                {loja: 31, inicio: '09:32', fim: '21:16', cupons: 165, faturamento: 3098.76, meta: 4265.0, canais: {auto: 0, delivery: 1087.65, viagem: 0}},
                {loja: 63, inicio: '10:32', fim: '21:32', cupons: 72, faturamento: 1043.21, meta: 2040.0, canais: {auto: 212.34, delivery: 0, viagem: 830.87}},
                {loja: 69, inicio: '09:01', fim: '21:40', cupons: 198, faturamento: 4987.65, meta: 4555.0, canais: {auto: 0, delivery: 3654.32, viagem: 1333.33}},
                {loja: 73, inicio: '10:36', fim: '18:26', cupons: 82, faturamento: 2087.65, meta: 2800.0, canais: {auto: 698.76, delivery: 912.34, viagem: 476.55}},
                {loja: 82, inicio: '09:02', fim: '19:50', cupons: 167, faturamento: 2987.65, meta: 2980.0, canais: {auto: 398.76, delivery: 1987.65, viagem: 0}},
                {loja: 86, inicio: '10:04', fim: '21:28', cupons: 102, faturamento: 3543.21, meta: 6395.0, canais: {auto: 1345.67, delivery: 612.34, viagem: 145.67}},
                {loja: 90, inicio: '10:23', fim: '22:01', cupons: 187, faturamento: 4456.78, meta: 4335.0, canais: {auto: 1654.32, delivery: 209.87, viagem: 698.76}},
                {loja: 97, inicio: '10:22', fim: '04:17', cupons: 148, faturamento: 4123.45, meta: 4085.0, canais: {auto: 2098.76, delivery: 134.56, viagem: 523.45}},
                {loja: 98, inicio: '08:39', fim: '19:24', cupons: 245, faturamento: 3321.98, meta: 4235.0, canais: {auto: 498.76, delivery: 543.21, viagem: 2289.01}},
                {loja: 101, inicio: '10:37', fim: '20:51', cupons: 112, faturamento: 2456.78, meta: 2435.0, canais: {auto: 0, delivery: 1456.78, viagem: 1000.00}},
                {loja: 118, inicio: '10:19', fim: '21:56', cupons: 98, faturamento: 2098.76, meta: 2905.0, canais: {auto: 912.34, delivery: 498.76, viagem: 698.77}},
                {loja: 126, inicio: '10:13', fim: '21:28', cupons: 376, faturamento: 10456.78, meta: 11540.0, canais: {auto: 612.34, delivery: 5987.65, viagem: 29.87}},
                {loja: 133, inicio: '10:06', fim: '21:45', cupons: 154, faturamento: 5098.76, meta: 5860.0, canais: {auto: 265.43, delivery: 3789.01, viagem: 912.34}},
                {loja: 145, inicio: '09:03', fim: '09:17', cupons: 135, faturamento: 2234.56, meta: 4255.0, canais: {auto: 698.76, delivery: 709.87, viagem: 876.54}},
                {loja: 157, inicio: '10:20', fim: '21:18', cupons: 102, faturamento: 2345.67, meta: 3390.0, canais: {auto: 0, delivery: 1543.21, viagem: 802.46}},
                {loja: 158, inicio: '09:48', fim: '21:38', cupons: 159, faturamento: 4321.98, meta: 4415.0, canais: {auto: 2345.67, delivery: 1678.90, viagem: 298.76}},
                {loja: 162, inicio: '09:21', fim: '20:40', cupons: 87, faturamento: 2789.01, meta: 3075.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 178, inicio: '09:26', fim: '22:09', cupons: 118, faturamento: 3789.01, meta: 2255.0, canais: {auto: 0, delivery: 2789.01, viagem: 0}},
                {loja: 183, inicio: '09:34', fim: '19:24', cupons: 119, faturamento: 1987.65, meta: 3005.0, canais: {auto: 912.34, delivery: 498.76, viagem: 576.55}},
                {loja: 189, inicio: '09:51', fim: '21:52', cupons: 195, faturamento: 2345.67, meta: 2815.0, canais: {auto: 698.76, delivery: 387.65, viagem: 1267.89}},
                {loja: 195, inicio: '10:14', fim: '21:23', cupons: 243, faturamento: 6098.76, meta: 6575.0, canais: {auto: 0, delivery: 3987.65, viagem: 2100.00}},
                {loja: 210, inicio: '08:43', fim: '20:47', cupons: 121, faturamento: 2765.43, meta: 3800.0, canais: {auto: 0, delivery: 1098.76, viagem: 0}},
                {loja: 247, inicio: '08:44', fim: '20:29', cupons: 108, faturamento: 1654.32, meta: 2035.0, canais: {auto: 0, delivery: 598.76, viagem: 1098.76}},
                {loja: 248, inicio: '07:32', fim: '23:49', cupons: 265, faturamento: 5678.90, meta: 5720.0, canais: {auto: 387.65, delivery: 2876.54, viagem: 1876.54}},
                {loja: 251, inicio: '08:35', fim: '15:56', cupons: 83, faturamento: 1023.45, meta: 1920.0, canais: {auto: 0, delivery: 58.76, viagem: 987.65}},
                {loja: 262, inicio: '08:29', fim: '21:15', cupons: 92, faturamento: 2345.67, meta: 2340.0, canais: {auto: 0, delivery: 1198.76, viagem: 1098.76}},
                {loja: 285, inicio: '10:44', fim: '21:42', cupons: 87, faturamento: 1654.32, meta: 3360.0, canais: {auto: 0, delivery: 543.21, viagem: 1100.00}},
                {loja: 294, inicio: '10:32', fim: '21:29', cupons: 115, faturamento: 2098.76, meta: 1975.0, canais: {auto: 354.32, delivery: 698.76, viagem: 1043.21}}
            ],
            "12/02/2026": [
                {loja: 5, inicio: '09:13', fim: '20:39', cupons: 112, faturamento: 3456.78, meta: 4000.0, canais: {auto: 912.34, delivery: 2098.76, viagem: 298.76}},
                {loja: 10, inicio: '13:51', fim: '21:31', cupons: 432, faturamento: 10987.65, meta: 10650.0, canais: {auto: 2567.89, delivery: 3456.78, viagem: 1789.01}},
                {loja: 28, inicio: '10:15', fim: '21:53', cupons: 189, faturamento: 4456.78, meta: 5220.0, canais: {auto: 1543.21, delivery: 2678.90, viagem: 412.34}},
                {loja: 31, inicio: '09:33', fim: '21:17', cupons: 176, faturamento: 3209.87, meta: 4275.0, canais: {auto: 0, delivery: 1198.76, viagem: 0}},
                {loja: 63, inicio: '10:33', fim: '21:33', cupons: 78, faturamento: 1123.45, meta: 2050.0, canais: {auto: 234.56, delivery: 0, viagem: 887.65}},
                {loja: 69, inicio: '09:00', fim: '21:39', cupons: 209, faturamento: 5123.45, meta: 4565.0, canais: {auto: 0, delivery: 3876.54, viagem: 1345.67}},
                {loja: 73, inicio: '10:37', fim: '18:27', cupons: 89, faturamento: 2198.76, meta: 2810.0, canais: {auto: 765.43, delivery: 987.65, viagem: 498.76}},
                {loja: 82, inicio: '09:02', fim: '19:49', cupons: 178, faturamento: 3098.76, meta: 2990.0, canais: {auto: 432.10, delivery: 2098.76, viagem: 0}},
                {loja: 86, inicio: '10:05', fim: '21:29', cupons: 109, faturamento: 3678.90, meta: 6400.0, canais: {auto: 1456.78, delivery: 678.90, viagem: 156.78}},
                {loja: 90, inicio: '10:24', fim: '22:02', cupons: 198, faturamento: 4678.90, meta: 4340.0, canais: {auto: 1765.43, delivery: 234.56, viagem: 765.43}},
                {loja: 97, inicio: '10:23', fim: '04:16', cupons: 159, faturamento: 4234.56, meta: 4095.0, canais: {auto: 2234.56, delivery: 145.67, viagem: 598.76}},
                {loja: 98, inicio: '08:40', fim: '19:25', cupons: 256, faturamento: 3456.78, meta: 4245.0, canais: {auto: 543.21, delivery: 598.76, viagem: 2345.67}},
                {loja: 101, inicio: '10:38', fim: '20:52', cupons: 119, faturamento: 2567.89, meta: 2445.0, canais: {auto: 0, delivery: 1543.21, viagem: 1098.76}},
                {loja: 118, inicio: '10:20', fim: '21:57', cupons: 105, faturamento: 2234.56, meta: 2915.0, canais: {auto: 987.65, delivery: 543.21, viagem: 765.43}},
                {loja: 126, inicio: '10:14', fim: '21:29', cupons: 398, faturamento: 10987.65, meta: 11560.0, canais: {auto: 678.90, delivery: 6321.45, viagem: 30.12}},
                {loja: 133, inicio: '10:07', fim: '21:46', cupons: 165, faturamento: 5234.56, meta: 5870.0, canais: {auto: 298.76, delivery: 3987.65, viagem: 987.65}},
                {loja: 145, inicio: '09:04', fim: '09:18', cupons: 145, faturamento: 2345.67, meta: 4265.0, canais: {auto: 765.43, delivery: 787.65, viagem: 987.65}},
                {loja: 157, inicio: '10:21', fim: '21:19', cupons: 109, faturamento: 2456.78, meta: 3395.0, canais: {auto: 0, delivery: 1678.90, viagem: 876.54}},
                {loja: 158, inicio: '09:49', fim: '21:39', cupons: 171, faturamento: 4567.89, meta: 4425.0, canais: {auto: 2543.21, delivery: 1789.01, viagem: 345.67}},
                {loja: 162, inicio: '09:22', fim: '20:41', cupons: 93, faturamento: 2987.65, meta: 3085.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 178, inicio: '09:27', fim: '22:10', cupons: 125, faturamento: 3987.65, meta: 2265.0, canais: {auto: 0, delivery: 2987.65, viagem: 0}},
                {loja: 183, inicio: '09:35', fim: '19:25', cupons: 127, faturamento: 2098.76, meta: 3015.0, canais: {auto: 987.65, delivery: 543.21, viagem: 609.87}},
                {loja: 189, inicio: '09:52', fim: '21:53', cupons: 208, faturamento: 2456.78, meta: 2825.0, canais: {auto: 765.43, delivery: 398.76, viagem: 1321.45}},
                {loja: 195, inicio: '10:15', fim: '21:24', cupons: 258, faturamento: 6345.67, meta: 6585.0, canais: {auto: 0, delivery: 4123.45, viagem: 2234.56}},
                {loja: 210, inicio: '08:44', fim: '20:48', cupons: 128, faturamento: 2890.12, meta: 3810.0, canais: {auto: 0, delivery: 1154.32, viagem: 0}},
                {loja: 247, inicio: '08:45', fim: '20:30', cupons: 115, faturamento: 1765.43, meta: 2045.0, canais: {auto: 0, delivery: 643.21, viagem: 1123.45}},
                {loja: 248, inicio: '07:33', fim: '23:50', cupons: 279, faturamento: 5876.54, meta: 5730.0, canais: {auto: 412.34, delivery: 2987.65, viagem: 1987.65}},
                {loja: 251, inicio: '08:36', fim: '15:57', cupons: 88, faturamento: 1098.76, meta: 1930.0, canais: {auto: 0, delivery: 62.34, viagem: 1032.10}},
                {loja: 262, inicio: '08:30', fim: '21:16', cupons: 98, faturamento: 2456.78, meta: 2350.0, canais: {auto: 0, delivery: 1254.32, viagem: 1198.76}},
                {loja: 285, inicio: '10:45', fim: '21:43', cupons: 92, faturamento: 1765.43, meta: 3370.0, canais: {auto: 0, delivery: 598.76, viagem: 1165.43}},
                {loja: 294, inicio: '10:33', fim: '21:30', cupons: 122, faturamento: 2234.56, meta: 1985.0, canais: {auto: 398.76, delivery: 743.21, viagem: 1098.76}}
            ],
            "13/02/2026": [
                {loja: 5, inicio: '09:10', fim: '20:41', cupons: 117, faturamento: 3468.01, meta: 4005.0, canais: {auto: 916.93, delivery: 2263.16, viagem: 287.92}},
                {loja: 10, inicio: '13:52', fim: '21:32', cupons: 440, faturamento: 11244.67, meta: 10605.0, canais: {auto: 2670.74, delivery: 3526.33, viagem: 1762.66}},
                {loja: 28, inicio: '10:16', fim: '21:54', cupons: 186, faturamento: 4553.9, meta: 5215.0, canais: {auto: 1483.52, delivery: 2696.43, viagem: 373.95}},
                {loja: 31, inicio: '09:33', fim: '21:17', cupons: 173, faturamento: 3256.98, meta: 4280.0, canais: {auto: 0, delivery: 1171.54, viagem: 0}},
                {loja: 63, inicio: '10:34', fim: '21:34', cupons: 76, faturamento: 1111.57, meta: 2055.0, canais: {auto: 237.48, delivery: 0, viagem: 1111.57}},
                {loja: 69, inicio: '09:02', fim: '21:42', cupons: 211, faturamento: 5193.42, meta: 4570.0, canais: {auto: 0, delivery: 3876.7, viagem: 1394.96}},
                {loja: 73, inicio: '10:38', fim: '18:28', cupons: 86, faturamento: 2147.35, meta: 2815.0, canais: {auto: 795.02, delivery: 1097.72, viagem: 254.61}},
                {loja: 82, inicio: '09:03', fim: '19:52', cupons: 177, faturamento: 3106.1, meta: 2995.0, canais: {auto: 421.82, delivery: 2029.92, viagem: 0}},
                {loja: 86, inicio: '10:06', fim: '21:30', cupons: 108, faturamento: 3642.71, meta: 6405.0, canais: {auto: 1485.02, delivery: 641.94, viagem: 152.48}},
                {loja: 90, inicio: '10:25', fim: '22:02', cupons: 198, faturamento: 4673.55, meta: 4345.0, canais: {auto: 1752.34, delivery: 217.27, viagem: 746.4}},
                {loja: 97, inicio: '10:24', fim: '04:19', cupons: 155, faturamento: 4223.68, meta: 4100.0, canais: {auto: 2306.69, delivery: 133.1, viagem: 542.1}},
                {loja: 98, inicio: '08:41', fim: '19:26', cupons: 258, faturamento: 3493.53, meta: 4245.0, canais: {auto: 532.17, delivery: 586.56, viagem: 2374.8}},
                {loja: 101, inicio: '10:39', fim: '20:53', cupons: 116, faturamento: 2575.19, meta: 2450.0, canais: {auto: 0, delivery: 1489.73, viagem: 1085.46}},
                {loja: 118, inicio: '10:21', fim: '21:58', cupons: 103, faturamento: 2239.19, meta: 2920.0, canais: {auto: 932.34, delivery: 540.76, viagem: 766.09}},
                {loja: 126, inicio: '10:15', fim: '21:30', cupons: 396, faturamento: 10997.7, meta: 11555.0, canais: {auto: 643.84, delivery: 6195.35, viagem: 31.07}},
                {loja: 133, inicio: '10:08', fim: '21:47', cupons: 164, faturamento: 5198.91, meta: 5875.0, canais: {auto: 278.37, delivery: 4016.21, viagem: 904.33}},
                {loja: 145, inicio: '09:05', fim: '09:19', cupons: 142, faturamento: 2451.98, meta: 4270.0, canais: {auto: 732, delivery: 736.95, viagem: 979.54}},
                {loja: 157, inicio: '10:22', fim: '21:20', cupons: 107, faturamento: 2516.24, meta: 3405.0, canais: {auto: 0, delivery: 1644.09, viagem: 872.15}},
                {loja: 158, inicio: '09:50', fim: '21:40', cupons: 168, faturamento: 4512.33, meta: 4425.0, canais: {auto: 2490.5, delivery: 1741.45, viagem: 280.38}},
                {loja: 162, inicio: '09:23', fim: '20:42', cupons: 91, faturamento: 2951.27, meta: 3090.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 178, inicio: '09:28', fim: '22:11', cupons: 124, faturamento: 3964.04, meta: 2270.0, canais: {auto: 0, delivery: 2933.02, viagem: 0}},
                {loja: 183, inicio: '09:36', fim: '19:26', cupons: 126, faturamento: 2092.38, meta: 3020.0, canais: {auto: 912.16, delivery: 542.95, viagem: 629.27}},
                {loja: 189, inicio: '09:53', fim: '21:54', cupons: 203, faturamento: 2519.29, meta: 2830.0, canais: {auto: 737.6, delivery: 379.76, viagem: 1401.93}},
                {loja: 195, inicio: '10:16', fim: '21:25', cupons: 256, faturamento: 6232.95, meta: 6590.0, canais: {auto: 0, delivery: 4180.13, viagem: 2052.82}},
                {loja: 210, inicio: '08:45', fim: '20:49', cupons: 128, faturamento: 2899.39, meta: 3815.0, canais: {auto: 0, delivery: 1176.61, viagem: 0}},
                {loja: 247, inicio: '08:46', fim: '20:31', cupons: 112, faturamento: 1768.7, meta: 2050.0, canais: {auto: 0, delivery: 632.17, viagem: 1136.53}},
                {loja: 248, inicio: '07:34', fim: '23:51', cupons: 277, faturamento: 6052.05, meta: 5735.0, canais: {auto: 387.87, delivery: 3040.98, viagem: 1978.3}},
                {loja: 251, inicio: '08:37', fim: '15:58', cupons: 88, faturamento: 1072.78, meta: 1935.0, canais: {auto: 0, delivery: 59.8, viagem: 1012.98}},
                {loja: 262, inicio: '08:31', fim: '21:17', cupons: 96, faturamento: 2489.25, meta: 2355.0, canais: {auto: 0, delivery: 1262.64, viagem: 1099.12}},
                {loja: 285, inicio: '10:46', fim: '21:44', cupons: 91, faturamento: 1741.23, meta: 3375.0, canais: {auto: 0, delivery: 546.45, viagem: 1194.78}},
                {loja: 294, inicio: '10:34', fim: '21:31', cupons: 120, faturamento: 2254.62, meta: 1990.0, canais: {auto: 360.98, delivery: 792.59, viagem: 1101.05}}
            ],
            "14/02/2026": [
                {loja: 5, inicio: '09:24', fim: '12:34', cupons: 29, faturamento: 886.93, meta: 4015.0, canais: {auto: 204.58, delivery: 565.12, viagem: 117.23}},
                {loja: 10, inicio: '12:06', fim: '12:15', cupons: 15, faturamento: 367.1, meta: 12645.0, canais: {auto: 0, delivery: 0, viagem: 112.93}},
                {loja: 28, inicio: '10:27', fim: '12:32', cupons: 18, faturamento: 396.84, meta: 5390.0, canais: {auto: 218.81, delivery: 172.54, viagem: 5.49}},
                {loja: 31, inicio: '09:38', fim: '12:36', cupons: 23, faturamento: 419.6, meta: 3335.0, canais: {auto: 0, delivery: 198.43, viagem: 0}},
                {loja: 63, inicio: '10:36', fim: '12:35', cupons: 13, faturamento: 243.17, meta: 1650.0, canais: {auto: 19.9, delivery: 0, viagem: 243.17}},
                {loja: 69, inicio: '09:49', fim: '12:32', cupons: 19, faturamento: 460.12, meta: 5095.0, canais: {auto: 0, delivery: 300.25, viagem: 189.63}},
                {loja: 73, inicio: '10:37', fim: '12:32', cupons: 13, faturamento: 226.44, meta: 2285.0, canais: {auto: 180.75, delivery: 0, viagem: 45.69}},
                {loja: 82, inicio: '09:03', fim: '12:32', cupons: 32, faturamento: 590.89, meta: 2100.0, canais: {auto: 0, delivery: 409.8, viagem: 0}},
                {loja: 86, inicio: '10:08', fim: '12:09', cupons: 14, faturamento: 331.55, meta: 5635.0, canais: {auto: 113.49, delivery: 29.9, viagem: 28.8}},
                {loja: 90, inicio: '10:47', fim: '12:21', cupons: 7, faturamento: 237.3, meta: 4955.0, canais: {auto: 129.04, delivery: 0, viagem: 0}},
                {loja: 97, inicio: '19:36', fim: '12:09', cupons: 28, faturamento: 631.59, meta: 6315.0, canais: {auto: 346.75, delivery: 259.16, viagem: 37.84}},
                {loja: 98, inicio: '09:55', fim: '12:34', cupons: 33, faturamento: 606.66, meta: 3780.0, canais: {auto: 0, delivery: 154.54, viagem: 452.12}},
                {loja: 101, inicio: '10:05', fim: '12:34', cupons: 11, faturamento: 262.79, meta: 2980.0, canais: {auto: 0, delivery: 130.57, viagem: 132.22}},
                {loja: 118, inicio: '10:34', fim: '12:22', cupons: 10, faturamento: 295.4, meta: 3870.0, canais: {auto: 205.63, delivery: 82.8, viagem: 6.97}},
                {loja: 126, inicio: null, fim: null, cupons: 10, faturamento: 406.17, meta: 13025.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 133, inicio: '10:09', fim: '12:25', cupons: 21, faturamento: 534.99, meta: 6680.0, canais: {auto: 0, delivery: 409.63, viagem: 125.36}},
                {loja: 145, inicio: '09:28', fim: '12:25', cupons: 14, faturamento: 232.3, meta: 4375.0, canais: {auto: 74.3, delivery: 119.44, viagem: 112.86}},
                {loja: 157, inicio: '10:28', fim: '12:29', cupons: 13, faturamento: 440.71, meta: 3365.0, canais: {auto: 0, delivery: 311.77, viagem: 128.94}},
                {loja: 158, inicio: '09:23', fim: '12:37', cupons: 21, faturamento: 580.7, meta: 4655.0, canais: {auto: 322.01, delivery: 258.69, viagem: 0}},
                {loja: 162, inicio: '09:42', fim: '12:23', cupons: 26, faturamento: 381.51, meta: 2985.0, canais: {auto: 0, delivery: 0, viagem: 0}},
                {loja: 178, inicio: '09:26', fim: '12:24', cupons: 13, faturamento: 361.86, meta: 2165.0, canais: {auto: 0, delivery: 289.9, viagem: 0}},
                {loja: 183, inicio: '10:54', fim: '12:35', cupons: 14, faturamento: 219.33, meta: 2540.0, canais: {auto: 0, delivery: 0, viagem: 219.33}},
                {loja: 189, inicio: '10:06', fim: '12:32', cupons: 29, faturamento: 327.98, meta: 2665.0, canais: {auto: 10.88, delivery: 75.88, viagem: 241.22}},
                {loja: 195, inicio: '09:51', fim: '12:30', cupons: 32, faturamento: 604.97, meta: 5780.0, canais: {auto: 0, delivery: 267.55, viagem: 337.42}},
                {loja: 210, inicio: '08:31', fim: '12:33', cupons: 57, faturamento: 1032.05, meta: 4025.0, canais: {auto: 0, delivery: 344.01, viagem: 0}},
                {loja: 247, inicio: '08:26', fim: '12:23', cupons: 27, faturamento: 338.39, meta: 1700.0, canais: {auto: 0, delivery: 55.17, viagem: 283.22}},
                {loja: 248, inicio: '07:13', fim: '12:35', cupons: 59, faturamento: 1009.95, meta: 5725.0, canais: {auto: 0, delivery: 357.27, viagem: 403.2}},
                {loja: 251, inicio: '08:31', fim: '12:36', cupons: 33, faturamento: 405.0, meta: 1705.0, canais: {auto: 0, delivery: 0, viagem: 405.0}},
                {loja: 262, inicio: '08:28', fim: '12:34', cupons: 31, faturamento: 505.79, meta: 2615.0, canais: {auto: 0, delivery: 168.13, viagem: 337.66}},
                {loja: 285, inicio: '08:38', fim: '12:24', cupons: 20, faturamento: 422.86, meta: 2585.0, canais: {auto: 0, delivery: 61.58, viagem: 361.28}},
                {loja: 294, inicio: '11:50', fim: '12:14', cupons: 4, faturamento: 153.47, meta: 2390.0, canais: {auto: 0, delivery: 113.67, viagem: 39.8}}
            ]
        };

        // Calcular dif e status para cada registro
        for (let data in dadosPorData) {
            dadosPorData[data].forEach(loja => {
                loja.dif = loja.faturamento - loja.meta;
                loja.difPercentual = loja.meta > 0 ? (loja.dif / loja.meta) * 100 : 0;
                loja.status = loja.dif >= 0 ? 'SIM' : 'NÃO';
                
                // Calcular Balcão (o que sobra dos canais)
                const somaCanais = (loja.canais.auto || 0) + (loja.canais.delivery || 0) + (loja.canais.viagem || 0);
                loja.canais.balcao = loja.faturamento - somaCanais;
                if (loja.canais.balcao < 0) loja.canais.balcao = 0;
            });
        }

        // Lista de todas as datas disponíveis
        const datasDisponiveis = Object.keys(dadosPorData).sort((a, b) => {
            const [diaA, mesA, anoA] = a.split('/').map(Number);
            const [diaB, mesB, anoB] = b.split('/').map(Number);
            return new Date(anoA, mesA-1, diaA) - new Date(anoB, mesB-1, diaB);
        });

        // Variáveis de estado
        let dataInicio = "10/02/2026";
        let dataFim = "14/02/2026";
        let periodoSelecionado = "7d"; // 'hoje', '7d', '15d', 'mes', 'custom'
        let canalPieChart, metasPieChart, top10BarChart, desempenhoBarChart;
        let lojasSelecionadas = [];
        let todasLojas = [];

        function getDadosPeriodo() {
            const dados = [];
            
            for (let data in dadosPorData) {
                if (isDataNoPeriodo(data, dataInicio, dataFim)) {
                    dados.push(...dadosPorData[data].map(loja => ({
                        ...loja,
                        data: data
                    })));
                }
            }
            
            return dados;
        }

        function isDataNoPeriodo(data, inicio, fim) {
            const [diaD, mesD, anoD] = data.split('/').map(Number);
            const [diaI, mesI, anoI] = inicio.split('/').map(Number);
            const [diaF, mesF, anoF] = fim.split('/').map(Number);
            
            const dataObj = new Date(anoD, mesD-1, diaD);
            const inicioObj = new Date(anoI, mesI-1, diaI);
            const fimObj = new Date(anoF, mesF-1, diaF);
            
            return dataObj >= inicioObj && dataObj <= fimObj;
        }

        function setPeriodo(tipo) {
            periodoSelecionado = tipo;
            
            // Atualizar botões ativos
            $('.period-btn').removeClass('active');
            $(`.period-btn[onclick="setPeriodo('${tipo}')"]`).addClass('active');
            
            const hoje = new Date();
            const dia = String(hoje.getDate()).padStart(2, '0');
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const ano = hoje.getFullYear();
            const dataHojeStr = `${dia}/${mes}/${ano}`;
            
            switch(tipo) {
                case 'hoje':
                    dataInicio = dataFim = "14/02/2026"; // Última data disponível
                    $('#dateRangeInputs').hide();
                    break;
                    
                case '7d':
                    dataInicio = "10/02/2026";
                    dataFim = "14/02/2026";
                    $('#dateRangeInputs').hide();
                    break;
                    
                case '15d':
                    dataInicio = "10/02/2026";
                    dataFim = "14/02/2026";
                    $('#dateRangeInputs').hide();
                    break;
                    
                case 'mes':
                    dataInicio = "10/02/2026";
                    dataFim = "14/02/2026";
                    $('#dateRangeInputs').hide();
                    break;
                    
                case 'custom':
                    $('#dateRangeInputs').show();
                    
                    // Converter datas para formato YYYY-MM-DD para input date
                    const [diaI, mesI, anoI] = dataInicio.split('/');
                    const [diaF, mesF, anoF] = dataFim.split('/');
                    
                    $('#dataInicio').val(`${anoI}-${mesI}-${diaI}`);
                    $('#dataFim').val(`${anoF}-${mesF}-${diaF}`);
                    break;
            }
            
            atualizarPeriodoDisplay();
            recarregarTudo();
        }

        function atualizarPorData() {
            if (periodoSelecionado === 'custom') {
                const dataInicioInput = $('#dataInicio').val();
                const dataFimInput = $('#dataFim').val();
                
                if (dataInicioInput && dataFimInput) {
                    const [anoI, mesI, diaI] = dataInicioInput.split('-');
                    const [anoF, mesF, diaF] = dataFimInput.split('-');
                    
                    dataInicio = `${diaI}/${mesI}/${anoI}`;
                    dataFim = `${diaF}/${mesF}/${anoF}`;
                    
                    atualizarPeriodoDisplay();
                    recarregarTudo();
                }
            }
        }

        function atualizarPeriodoDisplay() {
            const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            if (dataInicio === dataFim) {
                const [dia, mes, ano] = dataInicio.split('/');
                $('#periodoDisplay').text(`${dia} de ${meses[mes-1]} de ${ano}`);
                $('#headerDay').text(dia);
                $('#headerMonth').text(meses[mes-1].toUpperCase());
            } else {
                const [diaI, mesI, anoI] = dataInicio.split('/');
                const [diaF, mesF, anoF] = dataFim.split('/');
                
                if (mesI === mesF && anoI === anoF) {
                    $('#periodoDisplay').text(`${diaI} a ${diaF} de ${meses[mesI-1]} de ${anoI}`);
                } else {
                    $('#periodoDisplay').text(`${diaI}/${mesI}/${anoI} a ${diaF}/${mesF}/${anoF}`);
                }
                
                $('#headerDay').text(`${diaI}-${diaF}`);
                $('#headerMonth').text(`${meses[mesI-1].toUpperCase()} ${anoI}`);
            }
        }

        function recarregarTudo() {
            const dadosPeriodo = getDadosPeriodo();
            todasLojas = [...new Set(dadosPeriodo.map(loja => loja.loja))].sort((a, b) => a - b);
            lojasSelecionadas = [...todasLojas];
            
            preencherOpcoesLojas();
            atualizarTextoSelecionadas();
            carregarTabela();
            destruirGraficos();
            inicializarGraficos();
            atualizarKPIs();
            atualizarTabelaCanais();
        }

        function destruirGraficos() {
            if (canalPieChart) canalPieChart.destroy();
            if (metasPieChart) metasPieChart.destroy();
            if (top10BarChart) top10BarChart.destroy();
            if (desempenhoBarChart) desempenhoBarChart.destroy();
        }

        $(document).ready(function() {
            setPeriodo('7d'); // Iniciar com últimos 7 dias
            
            $(document).click(function(event) {
                if (!$(event.target).closest('#lojaMultiSelect').length) {
                    $('#lojaDropdown').removeClass('show');
                }
            });
            
            $('#lojaDropdown').click(function(event) {
                event.stopPropagation();
            });
        });

        // [MANTENHA TODAS AS FUNÇÕES EXISTENTES AQUI: 
        // preencherOpcoesLojas, toggleLojaDropdown, fecharDropdownLojas, filtrarLojas, 
        // toggleLoja, toggleAllLojas, atualizarTextoSelecionadas, carregarTabela, 
        // atualizarTabelaCanais, atualizarKPIs, formatMoney, formatPercent, 
        // aplicarFiltros, ordenarTabela, exportarExcel, inicializarGraficos]
        
        function preencherOpcoesLojas() {
            let html = '';
            todasLojas.forEach(loja => {
                const nomeLoja = lojaNomes[loja] || `Loja ${loja}`;
                const isSelected = lojasSelecionadas.includes(loja);
                html += `<div class="option-item ${isSelected ? 'selected' : ''}" onclick="toggleLoja(${loja})">
                    <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleLoja(${loja})">
                    <span>${nomeLoja}</span>
                </div>`;
            });
            $('#lojaOptions').html(html);
        }

        function toggleLojaDropdown() {
            $('#lojaDropdown').toggleClass('show');
            $('#lojaSearch').val('').focus();
            filtrarLojas();
        }

        function fecharDropdownLojas() {
            $('#lojaDropdown').removeClass('show');
        }

        function filtrarLojas() {
            const termo = $('#lojaSearch').val().toLowerCase();
            $('.option-item').each(function() {
                const texto = $(this).find('span').text().toLowerCase();
                $(this).toggle(texto.includes(termo));
            });
        }

        function toggleLoja(loja) {
            const index = lojasSelecionadas.indexOf(loja);
            if (index === -1) {
                lojasSelecionadas.push(loja);
            } else {
                lojasSelecionadas.splice(index, 1);
            }
            
            atualizarTextoSelecionadas();
            preencherOpcoesLojas();
            aplicarFiltros();
        }

        function toggleAllLojas() {
            if (lojasSelecionadas.length === todasLojas.length) {
                lojasSelecionadas = [];
            } else {
                lojasSelecionadas = [...todasLojas];
            }
            
            atualizarTextoSelecionadas();
            preencherOpcoesLojas();
            aplicarFiltros();
        }

        function atualizarTextoSelecionadas() {
            const count = lojasSelecionadas.length;
            $('#selectedCount').text(count);
            
            if (count === 0) {
                $('#selectedLojasText').text('Nenhuma loja');
            } else if (count === todasLojas.length) {
                $('#selectedLojasText').text('Todas as Lojas');
            } else if (count <= 3) {
                const nomes = lojasSelecionadas.sort((a, b) => a - b).map(l => lojaNomes[l] || `Loja ${l}`).join(', ');
                $('#selectedLojasText').text(nomes);
            } else {
                $('#selectedLojasText').text(`${count} lojas selecionadas`);
            }
        }

        function carregarTabela() {
            let html = '';
            const statusFiltro = $('#statusFilter').val();
            const dadosPeriodo = getDadosPeriodo();

            const dadosFiltrados = dadosPeriodo.filter(loja => {
                if (lojasSelecionadas.length > 0 && !lojasSelecionadas.includes(loja.loja)) return false;
                if (statusFiltro && loja.status != statusFiltro) return false;
                return true;
            });

            dadosFiltrados.forEach(loja => {
                const nomeLoja = lojaNomes[loja.loja] || `Loja ${loja.loja}`;
                const difClass = loja.dif >= 0 ? 'valor-positivo' : 'valor-negativo';
                const statusClass = loja.status === 'SIM' ? 'meta-sim' : 'meta-nao';
                
                html += `<tr>
                    <td>${loja.data || dataInicio}</td>
                    <td><span class="store-name">${nomeLoja}</span></td>
                    <td>${loja.inicio || '-'}</td>
                    <td>${loja.fim || '-'}</td>
                    <td>${loja.cupons}</td>
                    <td class="currency">R$ ${formatMoney(loja.faturamento)}</td>
                    <td class="currency">R$ ${formatMoney(loja.meta)}</td>
                    <td class="currency ${difClass}">R$ ${formatMoney(loja.dif)}</td>
                    <td class="${difClass}">${formatPercent(loja.difPercentual)}</td>
                    <td><span class="${statusClass}">${loja.status}</span></td>
                </tr>`;
            });

            $('#tableBody').html(html);
            atualizarKPIs(dadosFiltrados);
        }

        function atualizarTabelaCanais() {
            const statusFiltro = $('#statusFilter').val();
            const dadosPeriodo = getDadosPeriodo();
            
            const dadosFiltrados = dadosPeriodo.filter(loja => {
                if (lojasSelecionadas.length > 0 && !lojasSelecionadas.includes(loja.loja)) return false;
                if (statusFiltro && loja.status != statusFiltro) return false;
                return true;
            });
            
            let totaisCanais = {
                'Auto-Atendimento': 0,
                'Delivery': 0,
                'Viagem': 0,
                'Balcão': 0
            };
            
            dadosFiltrados.forEach(loja => {
                totaisCanais['Auto-Atendimento'] += loja.canais.auto || 0;
                totaisCanais['Delivery'] += loja.canais.delivery || 0;
                totaisCanais['Viagem'] += loja.canais.viagem || 0;
                totaisCanais['Balcão'] += loja.canais.balcao || 0;
            });
            
            const totalGeral = Object.values(totaisCanais).reduce((a, b) => a + b, 0);
            
            if (canalPieChart) {
                canalPieChart.data.datasets[0].data = Object.values(totaisCanais);
                canalPieChart.update();
            }
            
            let html = '';
            const icones = {
                'Auto-Atendimento': 'fa-robot',
                'Delivery': 'fa-motorcycle',
                'Viagem': 'fa-plane',
                'Balcão': 'fa-store'
            };
            
            const cores = {
                'Auto-Atendimento': '#4361ee',
                'Delivery': '#f72585',
                'Viagem': '#4cc9f0',
                'Balcão': '#ffd166'
            };
            
            Object.entries(totaisCanais).forEach(([canal, valor]) => {
                const participacao = totalGeral > 0 ? (valor / totalGeral * 100) : 0;
                html += `<tr>
                    <td><i class="fas ${icones[canal]}" style="color: ${cores[canal]}; margin-right: 8px;"></i> ${canal}</td>
                    <td class="currency">R$ ${formatMoney(valor)}</td>
                    <td>${participacao.toFixed(1)}%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${participacao}%"></div>
                        </div>
                    </td>
                </tr>`;
            });
            
            $('#canaisTableBody').html(html);
        }

        function atualizarKPIs(dadosFiltrados = null) {
            const statusFiltro = $('#statusFilter').val();
            const dadosPeriodo = getDadosPeriodo();
            
            const dados = dadosFiltrados || dadosPeriodo.filter(loja => {
                if (lojasSelecionadas.length > 0 && !lojasSelecionadas.includes(loja.loja)) return false;
                if (statusFiltro && loja.status != statusFiltro) return false;
                return true;
            });
            
            // Agrupar por loja para cálculos de lojas únicas
            const lojasUnicas = [...new Set(dados.map(l => l.loja))];
            const totalLojasUnicas = lojasUnicas.length;
            
            const totalFaturamento = dados.reduce((sum, loja) => sum + loja.faturamento, 0);
            const totalMeta = dados.reduce((sum, loja) => sum + loja.meta, 0);
            const totalDiferenca = totalFaturamento - totalMeta;
            const percentualDiferenca = totalMeta > 0 ? (totalDiferenca / totalMeta) * 100 : 0;
            const totalCupons = dados.reduce((sum, loja) => sum + loja.cupons, 0);
            const ticketMedio = totalCupons > 0 ? totalFaturamento / totalCupons : 0;
            
            // Calcular metas atingidas por loja no período
            const metasPorLoja = {};
            dados.forEach(loja => {
                if (!metasPorLoja[loja.loja]) {
                    metasPorLoja[loja.loja] = { total: 0, atingiu: 0 };
                }
                metasPorLoja[loja.loja].total++;
                if (loja.status === 'SIM') {
                    metasPorLoja[loja.loja].atingiu++;
                }
            });
            
            // Loja atingiu meta se teve mais dias com SIM do que com NÃO
            const lojasMetaSim = Object.values(metasPorLoja).filter(m => m.atingiu > m.total / 2).length;
            const percentualLojas = totalLojasUnicas > 0 ? (lojasMetaSim / totalLojasUnicas) * 100 : 0;
            
            $('#totalLojas').text(totalLojasUnicas);
            $('#totalFaturamento').text(`R$ ${formatMoney(totalFaturamento)}`);
            $('#totalMeta').text(`R$ ${formatMoney(totalMeta)}`);
            $('#totalDiferenca').text(`R$ ${formatMoney(totalDiferenca)}`);
            $('#percentualMeta').text(formatPercent(percentualDiferenca));
            $('#percentualDiferenca').text(formatPercent(percentualDiferenca));
            $('#ticketMedio').text(`R$ ${formatMoney(ticketMedio)}`);
            $('#metasAtingidas').text(`${lojasMetaSim}/${totalLojasUnicas}`);
            $('#percentualLojas').text(`${percentualLojas.toFixed(1)}%`);
            $('#lojasMetaSim').text(`${lojasMetaSim} lojas (${percentualLojas.toFixed(1)}%)`);
            $('#lojasMetaNao').text(`${totalLojasUnicas - lojasMetaSim} lojas (${(100 - percentualLojas).toFixed(1)}%)`);
            
            const percentualProgresso = totalMeta > 0 ? (totalFaturamento / totalMeta) * 100 : 0;
            $('#progressoMeta').css('width', `${percentualProgresso}%`);
            
            if (metasPieChart) {
                metasPieChart.data.datasets[0].data = [lojasMetaSim, totalLojasUnicas - lojasMetaSim];
                metasPieChart.update();
            }
        }

        function formatMoney(value) {
            return value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function formatPercent(value) {
            return (value > 0 ? '+' : '') + value.toFixed(2) + '%';
        }

        function aplicarFiltros() {
            carregarTabela();
            atualizarTabelaCanais();
            
            const statusFiltro = $('#statusFilter').val();
            const dadosPeriodo = getDadosPeriodo();

            const dadosFiltrados = dadosPeriodo.filter(loja => {
                if (lojasSelecionadas.length > 0 && !lojasSelecionadas.includes(loja.loja)) return false;
                if (statusFiltro && loja.status != statusFiltro) return false;
                return true;
            });
            
            // Agrupar por loja para os gráficos
            const dadosPorLoja = {};
            dadosFiltrados.forEach(loja => {
                if (!dadosPorLoja[loja.loja]) {
                    dadosPorLoja[loja.loja] = {
                        loja: loja.loja,
                        faturamento: 0,
                        meta: 0,
                        cupons: 0,
                        status: 'NÃO',
                        difPercentual: 0
                    };
                }
                dadosPorLoja[loja.loja].faturamento += loja.faturamento;
                dadosPorLoja[loja.loja].meta += loja.meta;
                dadosPorLoja[loja.loja].cupons += loja.cupons;
            });
            
            // Calcular status e percentual para cada loja
            Object.values(dadosPorLoja).forEach(loja => {
                loja.difPercentual = loja.meta > 0 ? ((loja.faturamento - loja.meta) / loja.meta) * 100 : 0;
                loja.status = loja.faturamento >= loja.meta ? 'SIM' : 'NÃO';
            });
            
            const dadosAgregados = Object.values(dadosPorLoja);
            
            if (desempenhoBarChart) {
                if (dadosAgregados.length > 0) {
                    desempenhoBarChart.data.labels = dadosAgregados.map(d => lojaNomes[d.loja] || `Loja ${d.loja}`);
                    desempenhoBarChart.data.datasets[0].data = dadosAgregados.map(d => 100 + d.difPercentual);
                    desempenhoBarChart.data.datasets[0].backgroundColor = dadosAgregados.map(d => d.difPercentual >= 0 ? '#06d6a0' : '#ef476f');
                } else {
                    desempenhoBarChart.data.labels = [];
                    desempenhoBarChart.data.datasets[0].data = [];
                }
                desempenhoBarChart.update();
            }
            
            if (top10BarChart) {
                if (dadosAgregados.length > 0) {
                    const top10Data = [...dadosAgregados].sort((a, b) => b.faturamento - a.faturamento).slice(0, Math.min(10, dadosAgregados.length));
                    top10BarChart.data.labels = top10Data.map(d => lojaNomes[d.loja] || `Loja ${d.loja}`);
                    top10BarChart.data.datasets[0].data = top10Data.map(d => d.faturamento);
                    top10BarChart.data.datasets[1].data = top10Data.map(d => d.meta);
                } else {
                    top10BarChart.data.labels = [];
                    top10BarChart.data.datasets[0].data = [];
                    top10BarChart.data.datasets[1].data = [];
                }
                top10BarChart.update();
            }
        }

        let ordemAtual = { coluna: -1, ascendente: true };

        function ordenarTabela(coluna) {
            const tbody = $('#tableBody');
            const linhas = tbody.find('tr').get();
            
            if (ordemAtual.coluna === coluna) {
                ordemAtual.ascendente = !ordemAtual.ascendente;
            } else {
                ordemAtual.coluna = coluna;
                ordemAtual.ascendente = true;
            }
            
            linhas.sort((a, b) => {
                const celulaA = $(a).children('td').eq(coluna).text();
                const celulaB = $(b).children('td').eq(coluna).text();
                
                let valorA, valorB;
                
                if (coluna === 0 || coluna === 1) {
                    valorA = celulaA;
                    valorB = celulaB;
                } else if (coluna === 4) {
                    valorA = parseInt(celulaA) || 0;
                    valorB = parseInt(celulaB) || 0;
                } else if (coluna === 5 || coluna === 6 || coluna === 7) {
                    valorA = parseFloat(celulaA.replace('R$ ', '').replace(/\./g, '').replace(',', '.')) || 0;
                    valorB = parseFloat(celulaB.replace('R$ ', '').replace(/\./g, '').replace(',', '.')) || 0;
                } else if (coluna === 8) {
                    valorA = parseFloat(celulaA.replace('%', '').replace('+', '')) || 0;
                    valorB = parseFloat(celulaB.replace('%', '').replace('+', '')) || 0;
                } else {
                    valorA = celulaA;
                    valorB = celulaB;
                }
                
                if (valorA < valorB) return ordemAtual.ascendente ? -1 : 1;
                if (valorA > valorB) return ordemAtual.ascendente ? 1 : -1;
                return 0;
            });
            
            tbody.empty().append(linhas);
            
            $('th i').removeClass('fa-sort-up fa-sort-down').addClass('fa-sort');
            const icone = ordemAtual.ascendente ? 'fa-sort-up' : 'fa-sort-down';
            $(`th:eq(${coluna}) i`).removeClass('fa-sort').addClass(icone);
        }

        function exportarExcel() {
            const statusFiltro = $('#statusFilter').val();
            const dadosPeriodo = getDadosPeriodo();

            const dadosFiltrados = dadosPeriodo.filter(loja => {
                if (lojasSelecionadas.length > 0 && !lojasSelecionadas.includes(loja.loja)) return false;
                if (statusFiltro && loja.status != statusFiltro) return false;
                return true;
            });

            const totalFaturamento = dadosFiltrados.reduce((sum, loja) => sum + loja.faturamento, 0);
            const totalMeta = dadosFiltrados.reduce((sum, loja) => sum + loja.meta, 0);
            const totalDiferenca = totalFaturamento - totalMeta;
            const percentualDiferenca = totalMeta > 0 ? (totalDiferenca / totalMeta) * 100 : 0;
            
            // Calcular lojas que atingiram meta no período
            const metasPorLoja = {};
            dadosFiltrados.forEach(loja => {
                if (!metasPorLoja[loja.loja]) {
                    metasPorLoja[loja.loja] = { total: 0, atingiu: 0 };
                }
                metasPorLoja[loja.loja].total++;
                if (loja.status === 'SIM') {
                    metasPorLoja[loja.loja].atingiu++;
                }
            });
            
            const lojasMetaSim = Object.values(metasPorLoja).filter(m => m.atingiu > m.total / 2).length;
            const totalLojasUnicas = Object.keys(metasPorLoja).length;

            const wb = XLSX.utils.book_new();
            
            const dadosDetalhamento = [
                ['RELATÓRIO DE METAS - SETOR PATTY'],
                [`Período: ${dataInicio} a ${dataFim} - Lojas Selecionadas: ${lojasSelecionadas.length} lojas, Status: ${statusFiltro || 'Todos'}`],
                []
            ];
            
            dadosDetalhamento.push([
                'Data', 'Loja', 'Início', 'Fim', 'Qtd Cupons', 
                'Faturamento (R$)', 'Meta (R$)', 'Diferença (R$)', 'Diferença %', 'Status'
            ]);
            
            dadosFiltrados.forEach(loja => {
                const nomeLoja = lojaNomes[loja.loja] || `Loja ${loja.loja}`;
                dadosDetalhamento.push([
                    loja.data || dataInicio,
                    nomeLoja,
                    loja.inicio || '-',
                    loja.fim || '-',
                    loja.cupons,
                    loja.faturamento,
                    loja.meta,
                    loja.dif,
                    loja.difPercentual,
                    loja.status
                ]);
            });
            
            dadosDetalhamento.push([]);
            dadosDetalhamento.push([
                'TOTAIS', '', '', '', 
                dadosFiltrados.reduce((sum, loja) => sum + loja.cupons, 0),
                totalFaturamento,
                totalMeta,
                totalDiferenca,
                percentualDiferenca,
                `${lojasMetaSim}/${totalLojasUnicas} lojas`
            ]);

            const wsDetalhamento = XLSX.utils.aoa_to_sheet(dadosDetalhamento);
            
            wsDetalhamento['!cols'] = [
                { wch: 12 }, { wch: 30 }, { wch: 8 }, { wch: 8 }, { wch: 12 },
                { wch: 18 }, { wch: 18 }, { wch: 18 }, { wch: 15 }, { wch: 12 }
            ];

            let totaisCanais = {
                'Auto-Atendimento': 0,
                'Delivery': 0,
                'Viagem': 0,
                'Balcão': 0
            };
            
            dadosFiltrados.forEach(loja => {
                totaisCanais['Auto-Atendimento'] += loja.canais.auto || 0;
                totaisCanais['Delivery'] += loja.canais.delivery || 0;
                totaisCanais['Viagem'] += loja.canais.viagem || 0;
                totaisCanais['Balcão'] += loja.canais.balcao || 0;
            });
            
            const totalCanais = Object.values(totaisCanais).reduce((a, b) => a + b, 0);
            
            const dadosCanais = [
                ['RESUMO POR CANAL'],
                [],
                ['Canal', 'Valor (R$)', 'Participação (%)']
            ];
            
            Object.entries(totaisCanais).forEach(([canal, valor]) => {
                dadosCanais.push([canal, valor, totalCanais > 0 ? (valor / totalCanais * 100) : 0]);
            });
            
            dadosCanais.push([]);
            dadosCanais.push(['TOTAL', totalCanais, '100.0']);

            const wsCanais = XLSX.utils.aoa_to_sheet(dadosCanais);
            wsCanais['!cols'] = [{ wch: 25 }, { wch: 18 }, { wch: 18 }];

            const ticketMedio = dadosFiltrados.reduce((sum, loja) => sum + loja.cupons, 0) > 0 ? 
                totalFaturamento / dadosFiltrados.reduce((sum, loja) => sum + loja.cupons, 0) : 0;
                
            const dadosIndicadores = [
                ['INDICADORES GERAIS'],
                [],
                ['Indicador', 'Valor'],
                ['Período', `${dataInicio} a ${dataFim}`],
                ['Total de Lojas (únicas)', totalLojasUnicas],
                ['Total de Registros', dadosFiltrados.length],
                ['Faturamento Total', totalFaturamento],
                ['Meta Total', totalMeta],
                ['Diferença', totalDiferenca],
                ['Percentual de Atingimento', totalMeta > 0 ? (totalFaturamento / totalMeta * 100) : 0],
                ['Ticket Médio', ticketMedio],
                ['Lojas que Atingiram Meta (período)', lojasMetaSim],
                ['Lojas Abaixo da Meta (período)', totalLojasUnicas - lojasMetaSim],
                ['Percentual de Metas Atingidas', totalLojasUnicas > 0 ? (lojasMetaSim / totalLojasUnicas * 100) : 0]
            ];

            const wsIndicadores = XLSX.utils.aoa_to_sheet(dadosIndicadores);
            wsIndicadores['!cols'] = [{ wch: 30 }, { wch: 20 }];

            XLSX.utils.book_append_sheet(wb, wsDetalhamento, 'Detalhamento');
            XLSX.utils.book_append_sheet(wb, wsCanais, 'Resumo por Canal');
            XLSX.utils.book_append_sheet(wb, wsIndicadores, 'Indicadores');

            const dataStr = `${dataInicio.replace(/\//g, '-')}_a_${dataFim.replace(/\//g, '-')}`;
            const nomeArquivo = `Setor_Patty_${dataStr}.xlsx`;

            XLSX.writeFile(wb, nomeArquivo);

            const btnExport = event.target.closest('.btn');
            const textoOriginal = btnExport.innerHTML;
            btnExport.innerHTML = '<i class="fas fa-check"></i> Excel Gerado!';
            btnExport.style.background = '#06d6a0';
            setTimeout(() => {
                btnExport.innerHTML = textoOriginal;
                btnExport.style.background = '';
            }, 2000);
        }

        function inicializarGraficos() {
            Chart.defaults.font.family = "'Inter', 'Segoe UI', Roboto, sans-serif";
            Chart.defaults.font.size = 12;

            const dadosPeriodo = getDadosPeriodo();

            let totaisCanais = {
                'Auto-Atendimento': 0,
                'Delivery': 0,
                'Viagem': 0,
                'Balcão': 0
            };
            
            dadosPeriodo.forEach(loja => {
                totaisCanais['Auto-Atendimento'] += loja.canais.auto || 0;
                totaisCanais['Delivery'] += loja.canais.delivery || 0;
                totaisCanais['Viagem'] += loja.canais.viagem || 0;
                totaisCanais['Balcão'] += loja.canais.balcao || 0;
            });

            canalPieChart = new Chart(document.getElementById('canalPieChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(totaisCanais),
                    datasets: [{
                        data: Object.values(totaisCanais),
                        backgroundColor: ['#4361ee', '#f72585', '#4cc9f0', '#ffd166'],
                        borderWidth: 0,
                        borderRadius: 8,
                        spacing: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20,
                                font: { size: 12, weight: '500' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(43, 45, 66, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: (ctx) => {
                                    const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                    const valor = ctx.raw;
                                    const percent = ((valor / total) * 100).toFixed(1);
                                    return `${ctx.label}: R$ ${formatMoney(valor)} (${percent}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Calcular metas por loja no período
            const metasPorLoja = {};
            dadosPeriodo.forEach(loja => {
                if (!metasPorLoja[loja.loja]) {
                    metasPorLoja[loja.loja] = { total: 0, atingiu: 0 };
                }
                metasPorLoja[loja.loja].total++;
                if (loja.status === 'SIM') {
                    metasPorLoja[loja.loja].atingiu++;
                }
            });
            
            const lojasMetaSim = Object.values(metasPorLoja).filter(m => m.atingiu > m.total / 2).length;
            const lojasMetaNao = Object.keys(metasPorLoja).length - lojasMetaSim;
            
            metasPieChart = new Chart(document.getElementById('metasPieChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Atingiram Meta', 'Não Atingiram'],
                    datasets: [{
                        data: [lojasMetaSim, lojasMetaNao],
                        backgroundColor: ['#06d6a0', '#ef476f'],
                        borderWidth: 0,
                        borderRadius: 8,
                        spacing: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20,
                                font: { size: 12, weight: '500' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(43, 45, 66, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: (ctx) => {
                                    const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                    const percent = ((ctx.raw / total) * 100).toFixed(1);
                                    return `${ctx.label}: ${ctx.raw} lojas (${percent}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Agregar dados por loja para gráficos
            const dadosPorLoja = {};
            dadosPeriodo.forEach(loja => {
                if (!dadosPorLoja[loja.loja]) {
                    dadosPorLoja[loja.loja] = {
                        loja: loja.loja,
                        faturamento: 0,
                        meta: 0
                    };
                }
                dadosPorLoja[loja.loja].faturamento += loja.faturamento;
                dadosPorLoja[loja.loja].meta += loja.meta;
            });
            
            const dadosAgregados = Object.values(dadosPorLoja);
            
            const top10Data = [...dadosAgregados].sort((a, b) => b.faturamento - a.faturamento).slice(0, 10);
            top10BarChart = new Chart(document.getElementById('top10BarChart'), {
                type: 'bar',
                data: {
                    labels: top10Data.map(d => lojaNomes[d.loja] || `Loja ${d.loja}`),
                    datasets: [
                        {
                            label: 'Faturamento',
                            data: top10Data.map(d => d.faturamento),
                            backgroundColor: '#4361ee',
                            borderRadius: 8,
                            barPercentage: 0.6,
                            categoryPercentage: 0.8
                        },
                        {
                            label: 'Meta',
                            data: top10Data.map(d => d.meta),
                            backgroundColor: '#f72585',
                            borderRadius: 8,
                            barPercentage: 0.6,
                            categoryPercentage: 0.8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'rect',
                                padding: 15,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(43, 45, 66, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: (ctx) => `R$ ${formatMoney(ctx.raw)}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f1f5f9',
                                drawBorder: false
                            },
                            ticks: {
                                callback: (value) => 'R$ ' + value.toLocaleString('pt-BR')
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });

            const desempenhoData = dadosAgregados.map(d => {
                const difPercentual = d.meta > 0 ? ((d.faturamento - d.meta) / d.meta) * 100 : 0;
                return {
                    ...d,
                    difPercentual,
                    status: d.faturamento >= d.meta ? 'SIM' : 'NÃO'
                };
            });

            desempenhoBarChart = new Chart(document.getElementById('desempenhoBarChart'), {
                type: 'bar',
                data: {
                    labels: desempenhoData.map(d => lojaNomes[d.loja] || `Loja ${d.loja}`),
                    datasets: [{
                        label: 'Atingimento da Meta (%)',
                        data: desempenhoData.map(d => 100 + d.difPercentual),
                        backgroundColor: desempenhoData.map(d => d.difPercentual >= 0 ? '#06d6a0' : '#ef476f'),
                        borderRadius: 8,
                        barPercentage: 0.7,
                        categoryPercentage: 0.9
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(43, 45, 66, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: (ctx) => `Atingimento: ${ctx.raw.toFixed(1)}%`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 200,
                            grid: {
                                color: '#f1f5f9',
                                drawBorder: false
                            },
                            ticks: {
                                callback: (value) => value + '%'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
